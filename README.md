# trimmingCover
自炊した本のカバーから電子書籍の表紙になりそうなところをトリミングするプログラムです。B6、200ページ前後の書籍を想定していますので、新書や300ページを超えるような分厚い書籍には対応していません。
変な名前つけちゃったなあと思っています。cover trimmer とかの方がよかったでしょうかね。
## プログラムについて
Perl で画像をいじるための練習プログラムです。高度なことはしていないはずです。動けばいいやくらいのつもりで書いているのでかなりスパゲティです。変数名とか、思いつきやコーディングした日で命名ルールすら変わっています。行儀の良いプログラムが好きな人は見たりしないほうが良いでしょう。


print 文によるデバッグを多用していましたので、不必要なprint文を削除しています。ところどころに空行があるのはそのせいだと思って下さい。また、プログラムにはコメントがほとんどありませんがご勘弁下さい。
### 開発背景
今は自炊するときでもカバーをページサイズに切ってスキャンするのですが、昔はそうでもなかったので整理のために作りました。
### 必要な動作環境
WindowsのActivePerlで作成しましたが、cygwin, Linux (Ubuntu14.04)でも動作しました。プラットフォームを変える時は改行コードに気をつけてください。
Windows で動かす場合、バッチファイルを作れば Drug & Drop もできるようです。

GDライブラリと、日本語書籍を扱う場合は Jcode ライブラリが必要です。お手元の環境によってはインストールに苦労するかもしれません。
### 使い方
コマンドプロンプトで

`trimmingCover.pl <ファイル名>` 


で動作します。幾つかの表紙候補となるファイルが出来てくると思います。
### 原理
単純に縦横比で見ています。縦横比が 1.43：1 のものと 1.55:1 のものに対応しています。
現状では、左側に白い余白が出来ても無視しています。
右端が少しだけ、背表紙が残っているケースなどを考えて色の変化点を見る試みをしていますが、特定の出版社のもの対策になっていればいいなと。
### 今後のアップデート
あまり考えていません。おそらくディープラーニングなんかで領域を切り出す方が効率がいいんじゃないでしょうか。
PNG対応するには $ARGV[$i]の拡張子 $names[1]を見て、
`
if ($names[1] eq "jpg"{
  $oldImage = newFromJpg GD::Image(\*OLD) || "Cannot make old image object\n";
}elsif ($names[1] eq "PNG"){
  $oldImage = newFromPng GD::Image(\*OLD) || "Cannot make old image object\n";
}

`
のように、53行目あたりを書き換えてやれば良いんだと思いますよ。私はPNG使わないのでわかりませんが…。
